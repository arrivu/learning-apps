<script type="text/javascript">
$(document).ready(function(){
    var frames = document.getElementsByTagName("iframe");
    for (var i = 0; i < frames.length; i++) {
 frames[i].src += "?wmode=opaque;"  
      }
});
</script>
<div class="row">
  <div class="container" style="width:100%;background: #F7F7F7;">
     <div class="span12" style="width:97%;margin-top:20px;">
        <ol class="breadcrumb" style="margin-left:30px;">
  <li><a href="/">Home</a>/</li>
  <li><a href="/courses" >Courses</a>/</li>  
    <li><a href="#" class="active"><%= @course.title %></a></li>  
  </ol>
      <div class="span3 content-box resource" style="float: left;margin-left:40px;">
             <div class="type-tag-positioner" style="background-image:url(<%= @course.course_image.url(:medium)  %>);background-size: 100% 96%;"></div>
        <div class="details" style="margin-top:165px;">
          <div class="we" style="margin:0px 5px;"><h2 >
            <%= @course.title %>
          </h2><%= rating_for @course, "rate" %></div>
          <div class="review-stars"  >
       <div class="tag" style="padding:0px 10px;margin: 30px -13px 0px 0px;">
        <div style="font-size: 14px;">courses tags with:</div>
        <ul class="tags" style="border:0px;">
         <% @course.tags.each do |tag| %> 
         <li><a href="<%=tagged_courses_path(tag: tag)%>" >
          <b> <%= tag.name%> </b>
          <span><%= tag.courses.count%></span></a></li>
          <% end %>
        </ul>
      </div>
      <div id="rating" style="font-size: 14px;float:left;width: 100%;text-align: right;margin: -95px 0px;border-bottom: 1px solid hsl(0, 0%, 86%);">
        <%=pluralize(@qty,"rate")if !!@qty %></div>
      </div>
      <ul class="author" style="text-align: center;border-bottom:0px;border-top:0px;margin: 0px 15px;"><% @course.teaching_staffs.each do |author|%>
        <li style="width:auto;">      
          <div class="user" style="margin: 0px 0px 10px -5px;font-size:18px;">
            <%= author.user.name %>
          </div>
          <% if author.user.omni_image_url.nil? %>
          <%= image_tag author.user.avatar.url(:thumb),size: "45x40", alt: author.user.name,:class=>"img-rounded", :style=>"border:3px solid #E7E372;margin-top: -10px;" %>
          <% else  %>
          <%= image_tag(author.user.omni_image_url,size: "45x40", alt: author.user.name,:class=>"img-rounded", :style=>"border:3px solid #E7E372;margin-top: -10px;")%>
          <% end  %>
        </li> 
      </ul>
      <div style="font-size: 13px;margin: -4px 13px;">
        <%= truncate(author.description, :length => 500)%></div>
        <% end %>
      </div>
    </div>
    <div class="span7">
      <div style="-webkit-box-sizing: border-box;-moz-box-sizing: border-box;box-sizing: border-box;
      -webkit-box-shadow: 0 1px 2px 1px rgba(0,0,0,0.25);box-shadow: 0 1px 2px 1px rgba(0,0,0,0.25);
      background-color: #fff;-webkit-border-radius: 1px;border-radius: 1px;padding: 0px 0px 48px 0px;
      margin-left: 0px;width: 100%;height: 100%;margin-bottom:20px;float:left;">
      <div style="background-image:url(<%= @course.course_background_image.url(:medium) %>);background-repeat: no-repeat;
        background-size: 100% 100%;height:250px;margin-top:0px;padding:10px;">
        <h1 style="color:#fff">
          <%= @course.title %>
        </h1>
        <h2 class="author_names" style="color:#fff;">
          with  <% @course.teaching_staffs.each do |author|%><%= author.name%><%end%>
        </h2>
        <p class="resource-tagline" style="color:#fff;">
          <%= @course.short_desc  %>
        </p>
      </div>
      <div class="tabbable">
        <ul class="nav nav-tabs" id="myTab" >
          <li class="active"><a href="#home">Overview</a></li>
          <li><a href="#profile">Previews</a></li>
        </ul>
        <div class="tab-content" style="width: 95%;float: left;">
          <div class="tab-pane active" id="home">
            <div class="aboutcompany">
              <div class="underlinetext">
                <div class="coursesyllabus">
                  <div class="">
                    <div class="">
                      <div class="">
                        <div class="">
                          <h3>Course Description</h3>
                        </div>
                        <div class="underlinetext" >
                          <%= @course.desc  %></br> </br>
                        </div></div>
                        <div class="">
                          <div class="">
                            <h3>Course Modules</h3>
                          </div>
                          <div class="underlinetext">
                             <ul>
            <% @modules.each do |m| %>
            <li>
              <h4 style="color:#000;font-size:17px;"><i class="icon-star" style="margin-right:5px;"></i><%= m.name %></h4>
            </li>
            <% end %>
          </ul>


                          </div>
                        </div>
        

   
</div>
</div>

</div>

<script>
$(document).ready(function(){
  $(".star").click(function(){
   $(".rated").html("Course Rated")
 });

$(".close").click(function(){
  var frames = document.getElementsByTagName("iframe");
  for (var i = 0; i < frames.length; i++) {
    frames[i].src += "&stop";
  }
});

});
</script>


 <script>
  $(function() {
  
    function filterPath(string) {
      return string
      .replace(/^\//,'')
      .replace(/(index|default).[a-zA-Z]{3,4}$/,'')
      .replace(/\/$/,'');
    }
  
    var locationPath = filterPath(location.pathname);
    var scrollElem = scrollableElement('html', 'body');
  
    // Any links with hash tags in them (can't do ^= because of fully qualified URL potential)
    $('a[href*=#]').each(function() {
  
      // Ensure it's a same-page link
      var thisPath = filterPath(this.pathname) || locationPath;
      if (  locationPath == thisPath
        && (location.hostname == this.hostname || !this.hostname)
        && this.hash.replace(/#/,'') ) {
  
          // Ensure target exists
          var $target = $(this.hash), target = this.hash;
          if (target) {
  
// Find location of target
var targetOffset = $target.offset().top;
$(this).click(function(event) {
  
  // Prevent jump-down
  event.preventDefault();
    //alert(target);
    if(target!="#previewcourse" && target!="#top" ) return;
  // Animate to target
  $(scrollElem).animate({scrollTop: targetOffset}, 900, function() {
  
    // Set hash in URL after animation successful
    location.hash = target;
  
  });
});
          }
      }
  
    });
  
    // Use the first element that is "scrollable"  (cross-browser fix?)
    function scrollableElement(els) {
      for (var i = 0, argLength = arguments.length; i <argLength; i++) {
        var el = arguments[i],
        $scrollElement = $(el);
        if ($scrollElement.scrollTop()> 0) {
          return el;
        } else {
          $scrollElement.scrollTop(1);
          var isScrollable = $scrollElement.scrollTop()> 0;
          $scrollElement.scrollTop(0);
          if (isScrollable) {
return el;
          }
        }
      }
      return [];
    }
  
  });
 </script>


</div></div></div>

  <div class="tab-pane" id="profile"><div class="aboutcompany">
<div class="underlinetext">
  <div class="previewcourse" id="previewcourse">
  <div class="">
    <div class="">
      <h2>Lecture Preview: A Sneak Peak into the course</h2>
      <% a=0 %>
      <% @course.course_previews.where(enable: 1).order(:sequence).each do |p| %>
      <% a +=1  %>
      <div class="span4 prevbox">
       <table> <tr>
         <td>
           <div class="bannervideo">
<% h = p.video_url %>
<% url = h[38..h.length-44].split('/')  %>

<a href="#preview_model<%= a %>" data-toggle="modal" > <img src="http://i.ytimg.com/vi/<%= url[4] %>/default.jpg" /></a>
      <div id="preview_model<%= a %>" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="position:fixed;margin:0px auto;left:28%;" >
  <button type="button" class="close" data-dismiss="modal" aria-hidden="true">

    <%=image_tag("close.png", alt: "")%></a>
   </a></button>

  <div class="modal-header">
    <h3 id="myModalLabel">Preview Video</h3>
  </div>

  <div class="modal-body" style="margin-left:0px;">

   <%= raw(p.video_url) %>
 </div>
           </div>
       </div>
       </td>
       <td>
         <div class="previnfo">
           <h3><%= p.name %></h3>
           <p class="prevtxt"><%= p.desc %></p>

         </div>
       </td>
     </tr>
   </table>
 </div>
 <% end %>
</div>
</div>
</div>
Â </div>
  </div></div>




</div>
</div>
</div>
</div>
<div class="span3 content-box resource" style="float: left;padding: 10px 20px 0px 20px;">
   <% if @course.is_coming_soon %>
<h4>Date to be announced</h4>
<% else %>
<% start=""
  if @course.start_date != nil 
    start=@course.start_date.to_formatted_s(:long)
  end
  duration=""
  if @course.start_date != nil and @course.end_date != nil 
    x=(@course.end_date - @course.start_date).to_i
    y=x/7
    z=x%7
    duration = pluralize(y,"Week") 
    if(z != 0) 
      duration = duration + " " + pluralize(z,"Day") 
    end
    duration = duration + " Long"
    #duration=distance_of_time_in_words(@course.start_date,@course.end_date)
  end
  next_session=""
  if @course.start_date != nil and @course.end_date != nil 
    next_session="Next Session: #{start} (#{duration})"
  end
 %>
<h4><%= next_session %></h4>
<% end %>
<% if @price.to_i != 0 %>
<h2>Rs&nbsp;<%= @price.to_i %></h2>
<% end %>

 <% if (current_user.present? ) %>
  <% if !(current_user.has_role? :admin) and !(current_user.has_role? :account_admin) and !(current_user.has_role? :teacher)%>

    <% if @course.is_coming_soon %>
    <% if @status!="follow" %>

      <%= link_to "Follow",payments_follow_course_path(:id=>@course.id),class: "btn btn-primary",style:"margin-bottom: 10px;margin-right: 95px;
float: right;" %>
      <% end %>
    <% elsif @status=="enroll" %>
    <a href="<%= lms_course_url("#{@course.lms_id}modules")%>"><div class= "btn btn-primary" style="margin-bottom: 10px;margin-right: 95px;
float: right;">Go To Class
    </div></a>
    <% elsif @status=="completed" %>
    
    <% else %>
    
     <% if !AccountUser.where(:account_id=> @account_id,:user_id=>@current_user.id).empty? %>

         <%= link_to "enroll",payments_course_payment_path(:id=>@course.id),class: "btn btn-primary",style:"margin-bottom: 10px;margin-right: 95px;
float: right;" %>
      <% else %>
           <a href="#alert_popup_Modal" role="button" data-toggle="modal" class="btn btn-primary"  >Enroll</a>
      <% end %>
    <% end %> 

  <% end %> 


<% else %>
  <% if @course.is_coming_soon %>
    <%= link_to "Follow",payments_follow_course_path(:id=>@course.id),class: "btn btn-primary",style:"margin-bottom: 10px;margin-right: 95px;
float: right;"%>
  <!--  <a href="#loginmodal" role="button" data-toggle="modal" class="enroll">Follow</a> -->
  
  <% else %>

  <% if @current_user !=nil %>
 <% if !AccountUser.where(  :account_id=> @account_id,:user_id=>@current_user. id).empty? %>

      <%= link_to "enroll",payments_course_payment_path(:id=>@course.id),class: "btn btn-primary",style:"margin-bottom: 10px;margin-right: 95px;
float: right;" %>
  <% else %>
     <a href="#alert_popup_Modal" role="button" data-toggle="modal" class="btn btn-primary" ,payments_follow_course_path(:id=>@course.id) >Enroll</a>
      <% end %>
      <% else %>
      <%= link_to "enroll",payments_course_payment_path(:id=>@course.id),class: "btn btn-primary",style:"margin-bottom: 10px;margin-right: 95px;
float: right;" %>

  <% end %> 
<% end %> 
<% end%>

</div>

<div class="span3 content-box resource" style="float: left;padding: 40px 40px 0px 0px; margin-top: 30px;">
   <!-- <div class="tab-pane" id="messages" style="padding:20px;"> -->
<div class="underlinetext">
   
<div class="coursereviews" >
  <div class="">
    <div class="">
      <div align="center" style="width:80%;background:#fff;box-shadow:2px 3px 2px #efefef;height:30px;padding-top:10px;margin:-55px 45px 10px;">
        <h4 style="margin-top:0px;color: #B3B3B3;"><%=@course.comments.size%> Reviews</h4>
              </div>
    </div>
    <%= render "comments/comments" %>
    <div class=" clearfix"></div>
 <div class="row">
  <div align="center">
 <div>
     
      <%= link_to "Reveiw",review_path(:commentable_id => @course.id,:commentable_type=> 'course'),class: "btn btn-primary",style:"margin-bottom: 10px;margin-right: -40px;"%>
  </div> 
</div>
</div>
</div>
</div>
</div>
 </div>
</div>
</div>




<script>
$('#myTab a').click(function (e) {
  e.preventDefault();
  $(this).tab('show');
})
</script>
